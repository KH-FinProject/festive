<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.project.festive.festiveserver.myPage.model.mapper.MyPageMapper">

	<!-- 회원의 비밀번호 조회 -->
	<select id="selectPw">
		SELECT PASSWORD
		FROM "MEMBER"
		WHERE MEMBER_NO =
		#{memberNo}
	</select>
	
	<!-- 회원 비밀번호 변경 -->
 	<update id="changePw">
 		UPDATE "MEMBER" SET
 		PASSWORD = #{encPw}
 		WHERE MEMBER_NO = #{memberNo}
 	</update>

	<!-- 회원 탈퇴 -->
	<update id="withdrawal">
		UPDATE "MEMBER" SET
		MEMBER_DEL_FL = 'Y'
		WHERE MEMBER_NO
		= #{memberNo}
	</update>
	
	<!-- 파일 정보 DB에 삽입 -->
	
	<!-- 파일 목록 조회 -->
	
	<!-- 프로필 이미지 변경 -->
	
	
	
	
	
	
	<!-- 내가 쓴 게시글 조회 -->
	<select id="selectMyPosts">
        SELECT
            b.BOARD_NO,
            b.BOARD_TITLE,
            m.MEMBER_NICKNAME,
            b.BOARD_CREAT_DATE,
            b.READ_COUNT,
            COUNT(l.MEMBER_NO) AS LIKE_COUNT
        FROM BOARD b
        JOIN MEMBER m ON b.MEMBER_NO = m.MEMBER_NO
        LEFT JOIN "LIKE" l ON b.BOARD_NO = l.BOARD_NO
        WHERE b.MEMBER_NO = #{memberNo}
        AND b.BOARD_DEL_FL = 'N'
        GROUP BY b.BOARD_NO, b.BOARD_TITLE, m.MEMBER_NICKNAME, b.BOARD_CREAT_DATE, b.READ_COUNT
        ORDER BY b.BOARD_CREAT_DATE DESC
    </select>
    
    <!-- 내가 작성한 댓글 조회 -->
    <select id="selectMyComments">
        SELECT c.COMMENT_NO,
               c.COMMENT_CONTENT,
               c.COMMENT_WRITE_DATE,
               c.BOARD_NO,
               m.MEMBER_NICKNAME,
               COUNT(cl.MEMBER_NO) AS LIKE_COUNT
        FROM "COMMENT" c
        JOIN MEMBER m ON c.MEMBER_NO = m.MEMBER_NO
        LEFT JOIN "COMMENT_LIKE" cl ON c.COMMENT_NO = cl.COMMENT_NO
        WHERE c.MEMBER_NO = #{memberNo} AND c.COMMENT_DEL_FL = 'N'
        GROUP BY c.COMMENT_NO, c.COMMENT_CONTENT, c.COMMENT_WRITE_DATE, c.BOARD_NO, m.MEMBER_NICKNAME
        ORDER BY c.COMMENT_WRITE_DATE DESC
    </select>
    
    <!-- 내 정보 수정 -->
    <update id="updateMemberInfo">
        UPDATE MEMBER
        SET TEL = #{tel},
            EMAIL = #{email},
            ADDRESS = #{address}
        WHERE MEMBER_NO = #{memberNo}
    </update>

	<!-- 내 정보 조회 -->
    <select id="selectMemberInfo">
        SELECT MEMBER_NO as memberNo, TEL as tel, EMAIL as email,
               ADDRESS as address, NICKNAME as nickname, NAME as name
        FROM MEMBER
        WHERE MEMBER_NO = #{memberNo}
    </select>


</mapper>